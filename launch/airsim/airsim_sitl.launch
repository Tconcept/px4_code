<?xml version="1.0" encoding="UTF-8"?>
<launch>

	<arg name = "pose_topic"  default =  "/vicon/mav_felipe/mav_felipe"/>
	<arg name = "airsim_world_frame"  default =  "/world_enu"/>
	<arg name = "airsim_drone_frame"  default =  "/PX4/odom_local_ned"/>
	<arg name = "mav_frame_id"  default =  "iris_fpv_cam__iris__base_link"/>


	<node pkg="tf" type="static_transform_publisher" name="map_matching" args="0 0 0 0 0 0 1  $(arg airsim_world_frame) /map 100" />
	<node pkg="tf" type="static_transform_publisher" name="drone_matching" args="0 0 0 0 1 0 0 $(arg airsim_drone_frame) $(arg mav_frame_id) 100" />
 
<!--tf from airsim to external pose topic-->	
    <node name="tf2pose" pkg="px4_code" type="tf2poseStamped_node" output="screen">   
	  <param name="map_frame" value="map"/>
        <param name="base_frame" value="$(arg mav_frame_id)"/>
        <param name="output_pose_topic" value="$(arg pose_topic)"/>
	</node>
	
<node name="rviz" pkg="rviz" type="rviz" args="-d $(find px4_code)/rviz/airsim_default.rviz"/>
  
	
<!--airsim -->	

    <include file = "$(find px4_code)/launch/airsim/airsim_node.launch"/>
    <include file = "$(find px4_code)/launch/airsim/depth_to_pointcloud.launch"/>
 
<!--mav wrapper-->
    <node name="mav_wrapper_node" pkg="px4_code" type="mav_wrapper_node" output="screen">   
              
        <!--param name="mav_frame_id" value="$(arg pose_topic)"/-->
        <param name="world_frame_id" value="/map"/>
        <param name="external_pose_topic" value="$(arg pose_topic)"/>

        <param name="pose_on" value="true"/>            
    </node>
<!--mav wrapper-->
    <include file = "$(find mavros)/launch/px4.launch">
      <arg name="fcu_url" value="udp://:14550@127.0.0.1:14556"/> 
            <!-- <arg name="fcu_url" value="udp://:14540@127.0.0.1:14557"/>  -->

    </include>
   
   <!--mav gcs-->
       <node name="mav_gcs_node" pkg="px4_code" type="mav_gcs_node">
	           <arg name="planner_node_name" value="/planner_client"/>         
		</node>


</launch>
